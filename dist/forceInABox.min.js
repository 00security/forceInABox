// https://github.com/john-guerra/forceInABox#readme v0.0.10 Copyright 2021 undefined
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):e.forceInABox=t(e.d3)}(this,function(e){"use strict";return function(){function t(e){return()=>e}var n,r,o=function(e){return e.index},c=[],i=[],u=[100,100],f=t(1),l=t(-1),a=t(100),s=t(.1),d={},g=.1,h=.001,p=[],y=[0,0],v=function(e){return e.cluster},x="treemap",m=!0,k=.1;function z(e){if(!m)return z;"force"===x&&(r.tick(),A());for(var t,n=0,o=c.length,i=e*k;n<o;++n)(t=c[n]).vx+=(d[v(t)].x-t.x)*i,t.vy+=(d[v(t)].y-t.y)*i}function S(){var t;c&&("treemap"===x?(t=e.treemap().size(z.size()),n=e.hierarchy(function(){var e,t,n,r=[];for(e of(n=w(z.nodes())).keys())t=n.get(e),r.push({id:e,size:t.count});return{id:"clustersTree",children:r}}()).sum(function(e){return e.size}).sort(function(e,t){return t.height-e.height||t.value-e.value}),p=t(n).leaves(),A()):function(){var t;if(c&&c.length){if(c&&c.length>0&&void 0===v(c[0]))throw Error("Couldnt find the grouping attribute for the nodes. Make sure to set it up with forceInABox.groupBy('clusterAttr') before calling .links()");var n;n=0,0!==c.length&&i.forEach(function(e){var t,r;if(c){if(t=e.source,r=e.target,"object"!=typeof e.source&&(t=c[e.source]),"object"!=typeof e.target&&(r=c[e.target]),void 0===t||void 0===r)throw Error("Error setting links, couldnt find nodes for a link (see it on the console)");e.source=t,e.target=r,e.index=n++}}),t=function(){var e,t,n,r,o=[],u=[],f=new Map;for(e of(n=w(c),r=function(e){var t=new Map,n=[];return e.forEach(function(e){var n,r=function(e){var t=v(e.source),n=v(e.target);return t<=n?t+"~"+n:n+"~"+t}(e);n=t.has(r)?t.get(r):0,n+=1,t.set(r,n)}),t.forEach(function(e,t){var r,o;r=t.split("~")[0],o=t.split("~")[1],void 0!==r&&void 0!==o&&n.push({source:r,target:o,count:e})}),n}(i),n.keys()))t=n.get(e),o.push({id:e,size:t.count,r:Math.sqrt(t.sumforceNodeSize/Math.PI)}),f.set(e,void 0);return r.forEach(function(e){var t=f.get(e.source),n=f.get(e.target);void 0!==t&&void 0!==n&&u.push({source:t,target:n,count:e.count})}),{nodes:o,links:u}}(),r=e.forceSimulation(t.nodes).force("x",e.forceX(u[0]/2).strength(.1)).force("y",e.forceY(u[1]/2).strength(.1)).force("collide",e.forceCollide(function(e){return e.r}).iterations(4)).force("charge",e.forceManyBody().strength(l)).force("links",e.forceLink(t.nodes.length?t.links:[]).distance(a).strength(s)),p=r.nodes(),A()}}())}function w(e){var t=new Map,n={};return e.forEach(function(e){t.has(v(e))||t.set(v(e),{count:0,sumforceNodeSize:0})}),e.forEach(function(e){(n=t.get(v(e))).count=n.count+1,n.sumforceNodeSize=n.sumforceNodeSize+Math.PI*(f(e)*f(e))*1.3,t.set(v(e),n)}),t}function A(){return d.none={x:0,y:0},p.forEach(function(e){"treemap"===x?d[e.data.id]={x:e.x0+(e.x1-e.x0)/2-y[0],y:e.y0+(e.y1-e.y0)/2-y[1]}:d[e.id]={x:e.x-y[0],y:e.y-y[1]}}),d}return z.initialize=function(e){c=e,S()},z.drawTemplate=function(e){return"treemap"===x?function(e){e.selectAll("circle.cell").remove(),e.selectAll("line.cell").remove(),e.selectAll("rect.cell").data(p).enter().append("svg:rect").attr("class","cell").attr("x",function(e){return e.x0}).attr("y",function(e){return e.y0}).attr("width",function(e){return e.x1-e.x0}).attr("height",function(e){return e.y1-e.y0})}(e):function e(t){t.selectAll("rect.cell").remove();var n=t.selectAll("line.cell").data(r.force("links").links());n.enter().append("line").attr("class","cell").merge(n).attr("x2",function(e){return e.source.x}).attr("y2",function(e){return e.source.y}).attr("x1",function(e){return e.target.x}).attr("y1",function(e){return e.target.y}).style("stroke-width","1px").style("stroke-opacity","0.5");var o=t.selectAll("circle.cell").data(r.nodes());o.enter().append("svg:circle").attr("class","cell").merge(o).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",function(e){return e.r}),r.on("tick",()=>{e(t)}).restart(),o.exit().remove(),n.exit().remove()}(e),z},z.drawTreemap=z.drawTemplate,z.deleteTemplate=function(e){return e.selectAll(".cell").remove(),r&&r.on("tick",null).restart(),z},z.template=function(e){return arguments.length?(x=e,S(),z):x},z.groupBy=function(e){return arguments.length?"string"==typeof e?(v=function(t){return t[e]},z):(v=e,z):v},z.enableGrouping=function(e){return arguments.length?(m=e,z):m},z.strength=function(e){return arguments.length?(k=e,z):k},z.getLinkStrength=function(e){return m?v(e.source)===v(e.target)?"function"==typeof g?g(e):g:"function"==typeof h?h(e):h:"function"==typeof g?g(e):g},z.id=function(e){return arguments.length?(o=e,z):o},z.size=function(e){return arguments.length?(u=e,z):u},z.linkStrengthInterCluster=function(e){return arguments.length?(h=e,z):h},z.linkStrengthIntraCluster=function(e){return arguments.length?(g=e,z):g},z.nodes=function(e){return arguments.length?(c=e,z):c},z.links=function(e){return arguments.length?(i=null===e?[]:e,S(),z):i},z.forceNodeSize=function(e){return arguments.length?(f="function"==typeof e?e:t(+e),S(),z):f},z.nodeSize=z.forceNodeSize,z.forceCharge=function(e){return arguments.length?(l="function"==typeof e?e:t(+e),S(),z):l},z.forceLinkDistance=function(e){return arguments.length?(a="function"==typeof e?e:t(+e),S(),z):a},z.forceLinkStrength=function(e){return arguments.length?(s="function"==typeof e?e:t(+e),S(),z):s},z.offset=function(e){return arguments.length?(y="function"==typeof e?e:t(+e),z):y},z.getFocis=A,z}});
